{
  "openapi": "3.0.0",
  "info": {
    "version": "0.0.1",
    "title": "otp-middleware",
    "license": {
      "name": "MIT"
    }
  },
  "components": {
    "parameters": {
      "AWSAuthHeaderRequired": {
        "deprecated": true,
        "description": "Use the proper authorization manager instead of passing this individual header.",
        "name": "Authorization",
        "in": "header",
        "required": false,
        "schema": {
          "type": "string"
        }
      },
      "IDParameter": {
        "name": "id",
        "in": "path",
        "description": "The ID of the entity to search.",
        "required": true,
        "schema": {
          "type": "string"
        }
      }
    },
    "responses": {
      "401Unauthorized": {
        "description": "API key or token is missing or could not be validated.",
        "headers": {
          "WWW_Authenticate": {
            "schema": {
              "type": "string"
            }
          }
        }
      },
      "AllowCORS": {
        "description": "Success",
        "headers": {
          "Access-Control-Allow-Origin": {
            "schema": {
              "type": "string"
            }
          },
          "Access-Control-Allow-Methods": {
            "schema": {
              "type": "string"
            }
          },
          "Access-Control-Allow-Headers": {
            "schema": {
              "type": "string"
            }
          }
        }
      },
      "OtpUser": {
        "description": "Success",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/OtpUser"
            }
          }
        },
        "headers": {
          "Access-Control-Allow-Origin": {
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "requestBodies": {
      "OtpUser": {
        "description": "The OtpUser entity to add or update.",
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/OtpUser"
            }
          }
        }
      }
    },
    "securitySchemes": {
      "Auth0Bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      },
      "ApiKey": {
        "type": "apiKey",
        "in": "header",
        "name": "x-api-key"
      }
    },
    "schemas": {
      "AbstractUser": {
        "description": "An abstract user.",
        "type": "object",
        "required": [
          "email",
          "auth0UserId"
        ],
        "properties": {
          "email": {
            "type": "string",
            "description": "Email address for contact. This must be unique in the collection."
          },
          "auth0UserId": {
            "type": "string",
            "description": "Auth0 user name."
          },
          "isDataToolsUser": {
            "type": "boolean",
            "description": "Determines whether this user has access to OTP Data Tools."
          }
        }
      },
      "AdminUser": {
        "allOf": [
          {
            "$ref": "#/components/schemas/AbstractUser"
          }
        ]
      },
      "OtpUser": {
        "allOf": [
          {
            "$ref": "#/components/schemas/AbstractUser"
          },
          {
            "type": "object",
            "properties": {
              "hasConsentedToTerms": {
                "type": "boolean",
                "description": "Whether the user has consented to the terms of use."
              },
              "isPhoneNumberVerified": {
                "type": "boolean",
                "description": "Whether the user's phone number has been verified (to be implemented)"
              },
              "notificationChannel": {
                "type": "string",
                "description": "Notification preferences for this user (\"email\", \"sms\", \"none\")."
              },
              "phoneNumber": {
                "type": "string",
                "description": "Phone number for SMS notifications."
              },
              "savedLocations": {
                "type": "object",
                "description": "Locations that the user has saved."
              },
              "storeTripHistory": {
                "type": "boolean",
                "description": "Whether to store the user's trip history (user must opt in)."
              }
            }
          }
        ]
      }
    }
  },
  "tags": [
    {
      "name": "admin",
      "description": "Interface for managing OTP admin users."
    },
    {
      "name": "api/secure/user",
      "description": "Interface for managing OTP users (general public)."
    }
  ],
  "paths": {
    "/api/admin/user": {
      "get": {
        "summary": "Gets all OTP admin users.",
        "tags": [
          "admin"
        ],
        "responses": {
          "200": {
            "description": "Successful response"
          }
        }
      },
      "options": {
        "tags": [
          "admin"
        ],
        "responses": {
          "200": {
            "description": "Successful response"
          }
        }
      },
      "post": {
        "summary": "Creates an OTP admin user.",
        "tags": [
          "admin"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminUser"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful response"
          }
        }
      }
    },
    "/api/secure/user": {
      "get": {
        "tags": [
          "api/secure/user"
        ],
        "description": "Gets a list of all OtpUser entities.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AWSAuthHeaderRequired"
          }
        ],
        "security": [
          {
            "ApiKey": [],
            "Auth0Bearer": []
          }
        ],
        "responses": {
          "200": {
            "description": "successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/OtpUser"
                  }
                }
              }
            },
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.Authorization": "method.request.header.Authorization"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "GET",
          "type": "http"
        }
      },
      "options": {
        "responses": {
          "200": {
            "$ref": "#/components/responses/AllowCORS"
          }
        },
        "tags": [
          "api/secure/user"
        ],
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user",
          "responses": {
            "default": {
              "statusCode": 200,
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'GET,POST,OPTIONS'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "OPTIONS",
          "type": "http"
        }
      },
      "post": {
        "tags": [
          "api/secure/user"
        ],
        "description": "Creates a new OtpUser entity.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AWSAuthHeaderRequired"
          }
        ],
        "security": [
          {
            "ApiKey": [],
            "Auth0Bearer": []
          }
        ],
        "requestBody": {
          "$ref": "#/components/requestBodies/OtpUser"
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/OtpUser"
          },
          "400": {
            "description": "400 response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "401 response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "500": {
            "description": "500 response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user",
          "responses": {
            "200": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            "401": {
              "statusCode": "401",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            "5\\d{2}": {
              "statusCode": "500",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.Authorization": "method.request.header.Authorization"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "POST",
          "type": "http"
        }
      }
    },
    "/api/secure/user/fromtoken": {
      "get": {
        "tags": [
          "api/secure/user"
        ],
        "description": "Retrieve a user from the Auth0 token.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AWSAuthHeaderRequired"
          }
        ],
        "security": [
          {
            "ApiKey": [],
            "Auth0Bearer": []
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/OtpUser"
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user/fromtoken",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.Authorization": "method.request.header.Authorization"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "GET",
          "type": "http"
        }
      },
      "options": {
        "responses": {
          "200": {
            "$ref": "#/components/responses/AllowCORS"
          }
        },
        "tags": [
          "api/secure/user"
        ],
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user/fromtoken",
          "responses": {
            "default": {
              "statusCode": 200,
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'GET,OPTIONS'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "OPTIONS",
          "type": "http"
        }
      }
    },
    "/api/secure/user/{id}": {
      "get": {
        "tags": [
          "api/secure/user"
        ],
        "description": "Returns an OtpUser entity with the specified id, or 404 if not found.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AWSAuthHeaderRequired"
          },
          {
            "$ref": "#/components/parameters/IDParameter"
          }
        ],
        "security": [
          {
            "ApiKey": [],
            "Auth0Bearer": []
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/OtpUser"
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user/{id}",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.Authorization": "method.request.header.Authorization",
            "integration.request.path.id": "method.request.path.id"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "GET",
          "type": "http"
        }
      },
      "put": {
        "tags": [
          "api/secure/user"
        ],
        "description": "Updates and returns the OtpUser entity with the specified id, or 404 if not found.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AWSAuthHeaderRequired"
          },
          {
            "$ref": "#/components/parameters/IDParameter"
          }
        ],
        "security": [
          {
            "ApiKey": [],
            "Auth0Bearer": []
          }
        ],
        "requestBody": {
          "$ref": "#/components/requestBodies/OtpUser"
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/OtpUser"
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user/{id}",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.Authorization": "method.request.header.Authorization",
            "integration.request.path.id": "method.request.path.id"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "PUT",
          "type": "http"
        }
      },
      "delete": {
        "tags": [
          "api/secure/user"
        ],
        "description": "Deletes the OtpUser entity with the specified id if it exists.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AWSAuthHeaderRequired"
          },
          {
            "$ref": "#/components/parameters/IDParameter"
          }
        ],
        "security": [
          {
            "ApiKey": [],
            "Auth0Bearer": []
          }
        ],
        "responses": {
          "200": {
            "description": "successful operation",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "400 response"
          },
          "401": {
            "description": "401 response"
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user/{id}",
          "responses": {
            "200": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            "400": {
              "statusCode": "400"
            },
            "401": {
              "statusCode": "401"
            }
          },
          "requestParameters": {
            "integration.request.header.Authorization": "method.request.header.Authorization",
            "integration.request.path.id": "method.request.path.id"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "DELETE",
          "type": "http"
        }
      },
      "options": {
        "tags": [
          "api/secure/user"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParameter"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/AllowCORS"
          }
        },
        "x-amazon-apigateway-integration": {
          "uri": "http://54.147.40.127/api/secure/user/{id}",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'DELETE,GET,OPTIONS,PUT'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.path.id": "method.request.path.id"
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "OPTIONS",
          "type": "http"
        }
      }
    }
  }
}
